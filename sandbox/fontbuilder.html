<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
	 "http://www.w3.org/TR/html4/strict.dtd">

<html>

<head>

	<meta http-equiv="content-type" content="text/html;charset=utf-8">
	<script type="text/javascript" src="../build/lib/three.min.js"></script>
<!-- JSModeler includes start -->
	<script type="text/javascript" src="../src/core/jsm.js"></script>
	<script type="text/javascript" src="../src/core/timer.js"></script>
	<script type="text/javascript" src="../src/core/algorithm.js"></script>
	<script type="text/javascript" src="../src/core/async.js"></script>
	<script type="text/javascript" src="../src/core/check.js"></script>
	<script type="text/javascript" src="../src/core/jsonloader.js"></script>
	<script type="text/javascript" src="../src/geometry/definitions.js"></script>
	<script type="text/javascript" src="../src/geometry/coord2d.js"></script>
	<script type="text/javascript" src="../src/geometry/coord.js"></script>
	<script type="text/javascript" src="../src/geometry/determinant.js"></script>
	<script type="text/javascript" src="../src/geometry/coordutils.js"></script>
	<script type="text/javascript" src="../src/geometry/matrix.js"></script>
	<script type="text/javascript" src="../src/geometry/coordsystem.js"></script>
	<script type="text/javascript" src="../src/geometry/sector.js"></script>
	<script type="text/javascript" src="../src/geometry/line.js"></script>
	<script type="text/javascript" src="../src/geometry/box.js"></script>
	<script type="text/javascript" src="../src/geometry/sphere.js"></script>
	<script type="text/javascript" src="../src/geometry/transformation.js"></script>
	<script type="text/javascript" src="../src/geometry/plane.js"></script>
	<script type="text/javascript" src="../src/geometry/projection.js"></script>
	<script type="text/javascript" src="../src/geometry/convexhull.js"></script>
	<script type="text/javascript" src="../src/geometry/polygon2d.js"></script>
	<script type="text/javascript" src="../src/geometry/polygon.js"></script>
	<script type="text/javascript" src="../src/geometry/cutpolygon.js"></script>
	<script type="text/javascript" src="../src/geometry/triangulation.js"></script>
	<script type="text/javascript" src="../src/geometry/octree.js"></script>
	<script type="text/javascript" src="../src/geometry/bsptree.js"></script>
	<script type="text/javascript" src="../src/geometry/curves.js"></script>
	<script type="text/javascript" src="../src/geometry/utilities.js"></script>
	<script type="text/javascript" src="../src/geometry/ray.js"></script>
	<script type="text/javascript" src="../src/geometry/path.js"></script>
	<script type="text/javascript" src="../src/modeler/color.js"></script>
	<script type="text/javascript" src="../src/modeler/material.js"></script>
	<script type="text/javascript" src="../src/modeler/materialset.js"></script>
	<script type="text/javascript" src="../src/modeler/body.js"></script>
	<script type="text/javascript" src="../src/modeler/model.js"></script>
	<script type="text/javascript" src="../src/modeler/adjacencyinfo.js"></script>
	<script type="text/javascript" src="../src/modeler/bodyutils.js"></script>
	<script type="text/javascript" src="../src/modeler/textureutils.js"></script>
	<script type="text/javascript" src="../src/modeler/cututils.js"></script>
	<script type="text/javascript" src="../src/modeler/generator.js"></script>
	<script type="text/javascript" src="../src/modeler/camera.js"></script>
	<script type="text/javascript" src="../src/modeler/explode.js"></script>
	<script type="text/javascript" src="../src/modeler/exporter.js"></script>
	<script type="text/javascript" src="../src/modeler/trianglebody.js"></script>
	<script type="text/javascript" src="../src/modeler/trianglemodel.js"></script>
	<script type="text/javascript" src="../src/modeler/converter.js"></script>
	<script type="text/javascript" src="../src/modeler/rayutils.js"></script>
	<script type="text/javascript" src="../src/import/binaryreader.js"></script>
	<script type="text/javascript" src="../src/import/importer.js"></script>
	<script type="text/javascript" src="../src/import/importer3ds.js"></script>
	<script type="text/javascript" src="../src/import/importerobj.js"></script>
	<script type="text/javascript" src="../src/import/importerstl.js"></script>
	<script type="text/javascript" src="../src/import/importercommon.js"></script>
	<script type="text/javascript" src="../src/renderer/webglutils.js"></script>
	<script type="text/javascript" src="../src/renderer/renderlight.js"></script>
	<script type="text/javascript" src="../src/renderer/rendermaterial.js"></script>
	<script type="text/javascript" src="../src/renderer/rendermesh.js"></script>
	<script type="text/javascript" src="../src/renderer/renderbody.js"></script>
	<script type="text/javascript" src="../src/renderer/shaderprogram.js"></script>
	<script type="text/javascript" src="../src/renderer/renderer.js"></script>
	<script type="text/javascript" src="../src/renderer/pointcloudrenderer.js"></script>
	<script type="text/javascript" src="../src/renderer/renderconverter.js"></script>
	<script type="text/javascript" src="../src/viewer/mouse.js"></script>
	<script type="text/javascript" src="../src/viewer/touch.js"></script>
	<script type="text/javascript" src="../src/viewer/painter.js"></script>
	<script type="text/javascript" src="../src/viewer/drawing.js"></script>
	<script type="text/javascript" src="../src/viewer/navigation.js"></script>
	<script type="text/javascript" src="../src/viewer/softwareviewer.js"></script>
	<script type="text/javascript" src="../src/viewer/spriteviewer.js"></script>
	<script type="text/javascript" src="../src/viewer/viewer.js"></script>
	<script type="text/javascript" src="../src/viewer/pointcloudviewer.js"></script>
	<script type="text/javascript" src="../src/extras/solidgenerator.js"></script>
	<script type="text/javascript" src="../src/extras/extgenerator.js"></script>
	<script type="text/javascript" src="../src/extras/subdivision.js"></script>
	<script type="text/javascript" src="../src/extras/csg.js"></script>
	<script type="text/javascript" src="../src/extras/surfaces.js"></script>
	<script type="text/javascript" src="../src/extensions/svgtomodel/svgtomodel.js"></script>
	<script type="text/javascript" src="../src/extensions/geojsontomodel/geojsontomodel.js"></script>
	<script type="text/javascript" src="../src/extensions/threeviewer/threeconverter.js"></script>
	<script type="text/javascript" src="../src/extensions/threeviewer/threeviewer.js"></script>
<!-- JSModeler includes end -->
	<title>Example</title>

	<script type="text/javascript">
		JSM.GeneratePrismsFromPath2D = function (path)
		{
			function GetPrismPolygon (polygon)
			{
				var result = [];
				var i, j, contour, vertex;
				for (i = 0; i < polygon.ContourCount (); i++) {
					contour = polygon.GetContour (i);
					for (j = 0; j < contour.VertexCount (); j++) {
						vertex = contour.GetVertex (j);
						result.push (new JSM.Coord (vertex.x, vertex.y, 0.0));
					}
					if (i < polygon.ContourCount () - 1) {
						result.push (null);
					}
				}
				return result;
			}
		
			var bodies = [];
			var polygons = path.GetPolygons ();
			var i, polygon;
			for (i = 0; i < polygons.length; i++) {
				polygon = polygons[i];
				var direction = new JSM.Vector (0.0, 0.0, 1.0);
				if (polygon.ContourCount () === 1) {
					bodies.push (JSM.GeneratePrism (GetPrismPolygon (polygon), direction, 100.0, true));
				} else if (polygon.ContourCount () > 1) {
					bodies.push (JSM.GeneratePrismWithHole (GetPrismPolygon (polygon), direction, 100.0, true));
				}
			}
			return bodies;
		};
		
		function GetCoordinateArrays (path)
		{
			var result = [];
			var polygons = path.GetPolygons ();
			var i, j, polygon, polygonArray, polygonVertex, resultArray;
			for (i = 0; i < polygons.length; i++) {
				polygon = polygons[i];
				polygonArray = polygon.ToArray ();
				resultArray = [];
				for (j = 0; j < polygonArray.length; j++) {
					polygonVertex = polygonArray[j];
					if (polygonVertex === null) {
						resultArray.push (null);
					} else {
						resultArray.push ([polygonVertex.x, polygonVertex.y]);
					}
				}
				result.push (resultArray);
			}
			return result;
		};		
		
		JSM.GenerateText = function (text, fontSpec, offsetX)
		{
			function CreatePathFromSpecification (commands, offsetX)
			{
				function Num (str)
				{
					return parseFloat (str);
				}
			
				var path = new JSM.Path2D ({
					segmentation : 10
				});
				
				var parts = commands.split (' ');
				var index = 0;
				var current;
				while (index < parts.length) {
					current = parts[index++];
					if (current.length === 0) {
						continue;
					}
					if (current == 'm') {
						path.MoveTo (Num (parts[index++]) + offsetX, Num (parts[index++]));
					} else if (current == 'l') {
						path.LineTo (Num (parts[index++]) + offsetX, Num (parts[index++]));
					} else if (current == 'b') {
						path.CubicBezierTo (Num (parts[index++]) + offsetX, Num (parts[index++]), Num (parts[index++]) + offsetX, Num (parts[index++]), Num (parts[index++]) + offsetX, Num (parts[index++]));
					} else if (current == 'z') {
						path.Close ();
					} else {
						alert (current);
					}
				}
				return path;
			};

			function GenerateCharacterBodies (character, fontSpec, offsetX, model)
			{
				var path = CreatePathFromSpecification (fontSpec, offsetX);
				var bodies = JSM.GeneratePrismsFromPath2D (path);
				var i, body;
				for (i = 0; i < bodies.length; i++) {
					body = bodies[i];
					model.AddBody (body);
				}
			}
			
			var model = new JSM.Model ();
			var offsetX = 0.0;
			var i, character;
			for (i = 0; i < text.length; i++) {
				character = text[i];
				if (fontSpec.glyphs[character] === undefined) {
					continue;
				}
				GenerateCharacterBodies (character, fontSpec.glyphs[character]['o'], offsetX, model);
				offsetX += fontSpec.glyphs[character]['ha'];
			}
			return model;
		};
		
		function Load ()
		{
			var viewerSettings = {
				cameraEyePosition : [-2.0, -1.5, 1.0],
				cameraCenterPosition : [0.0, 0.0, 0.0],
				cameraUpVector : [0, 0, 1],
				nearClippingPlane : 10,
				farClippingPlane : 100000
			};

			var viewer = new JSM.ThreeViewer ();
			viewer.Start (document.getElementById ('example'), viewerSettings);
			
			
			JSM.LoadJsonFile ('firasans_font.json', function (jsonData) {
				var model = JSM.GenerateText ('hello!', jsonData);
				var meshes = JSM.ConvertModelToThreeMeshes (model);
				viewer.AddMeshes (meshes);
				viewer.FitInWindow ();
				viewer.Draw ();
			});
		}
	
	    window.onload = function ()
		{
			Load ();			
		}
	</script>

</head>

<body>
	<canvas id="example" width="800" height="500"></canvas>
</body>

</html>
